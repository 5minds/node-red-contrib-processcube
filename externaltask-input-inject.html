<script type="text/javascript">
    RED.nodes.registerType('externaltask-input-inject', {
        category: 'ProcessCube',
        color: '#F6A923',
        defaults: {
            name: { value: '' },
            payloadType: { value: 'json' },
            payload: { value: '{}' },
            taskType: { value: 'json' },
            task: { value: '{}' }
        },
        inputs: 0,
        outputs: 1,
        icon: 'externaltask_input.svg',
        label: function () {
            return this.name || 'externaltask-input-inject';
        },
        button: {
            onclick: function() {
                var node = this;

                $.ajax({
                    type: "POST",
                    url: "externaltask-input-inject/trigger/" + node.id,
                    success: function(resp) {
                        RED.notify("Message injected", "success");
                    },
                    error: function(xhr, status, err) {
                        RED.notify("Error injecting message: " + err, "error");
                    }
                });
            }
        },
        oneditprepare: function () {
            // Initialize the typed input for payload
            $('#node-input-payload').typedInput({
                default: 'json',
                types: ['str', 'num', 'bool', 'json', 'jsonata', 'flow', 'global']
            });
            // Initialize the typed input for task
            $('#node-input-task').typedInput({
                default: 'json',
                types: ['str', 'num', 'bool', 'json', 'jsonata', 'flow', 'global']
            });
        },
        oneditsave: function () {
            var payloadValue = $('#node-input-payload').typedInput('value');
            var payloadType = $('#node-input-payload').typedInput('type');
            this.payload = payloadValue;
            this.payloadType = payloadType;

            var taskValue = $('#node-input-task').typedInput('value');
            var taskType = $('#node-input-task').typedInput('type');
            this.task = taskValue;
            this.taskType = taskType;
        }
     });
</script>

<script type="text/html" data-template-name="externaltask-input-inject">
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name" />
    </div>
    <div class="form-row">
        <label for="node-input-payload">msg.payload</label>
        <input type="hidden" id="node-input-payloadType">
        <input type="text" id="node-input-payload" style="width: 70%;">
    </div>
    <div class="form-row">
        <label for="node-input-task">msg.task</label>
        <input type="hidden" id="node-input-taskType">
        <input type="text" id="node-input-task" style="width: 70%;">
    </div>
</script>

<script type="text/markdown" data-help-name="externaltask-input-inject">
Inject a message with configured payload and metadata.

## Configs

: name (string) : The name of the node
: payload (string | {}) : The payload to inject
: task (string | {}) : The task object to inject

## Input

: payload (string | {}) : The payload to inject.
: task (string | {}) : The task object to inject.

## Outputs

: payload (string | {}) : The injected payload with metadata (flowNodeInstanceId, processInstanceId, task).
: task (object) : The injected task object with flowNodeInstanceId and processInstanceId.

### References

-   [The ProcessCube&copy; Developer Network](https://processcube.io) - All documentation for the ProcessCube&copy; platform
-   [ProcessCube&copy; LowCode Integration](https://processcube.io/docs/node-red) - LowCode integration in ProcessCube&copy;
</script>
